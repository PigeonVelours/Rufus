<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MoneyFlow</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #f3f7fa;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h1 {
      background-color: #0077b6;
      color: white;
      padding: 20px;
      margin: 0;
      border-bottom-left-radius: 15px;
      border-bottom-right-radius: 15px;
    }
    button {
      background-color: #0096c7;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background-color: #00b4d8;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 90%;
      background: white;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #caf0f8;
    }
    .delete-btn {
      background-color: #d00000;
      border-radius: 50%;
      padding: 6px 10px;
    }
    .delete-btn:hover {
      background-color: #ff1e00;
    }
    input, select {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin: 5px;
    }
  </style>
</head>
<body>
  <h1>üí∏ MoneyFlow</h1>

  <div>
    <button id="exportBtn">üì§ Exporter mes donn√©es</button>
    <button id="importBtn">üì• Importer des donn√©es</button>
    <input type="file" id="importFile" accept=".json" style="display:none;">
  </div>

  <div id="app"></div>

  <script>
    let data = JSON.parse(localStorage.getItem('moneyflow_data')) || {
      categories: [],
      transactions: []
    };

    function sauvegarder() {
      localStorage.setItem('moneyflow_data', JSON.stringify(data));
    }

    function afficher() {
      let app = document.getElementById('app');
      app.innerHTML = '';

      // --- Cat√©gories ---
      let catDiv = document.createElement('div');
      catDiv.innerHTML = "<h2>Cat√©gories</h2>";
      let catTable = document.createElement('table');
      catTable.innerHTML = "<tr><th>Nom</th><th>Type</th><th>Action</th></tr>";

      data.categories.forEach((cat, i) => {
        let row = document.createElement('tr');
        row.innerHTML = `
          <td>${cat.nom}</td>
          <td>${cat.type}</td>
          <td><button class='delete-btn' onclick='supprimerCategorie(${i})'>üóëÔ∏è</button></td>`;
        catTable.appendChild(row);
      });
      catDiv.appendChild(catTable);

      // Ajout Cat√©gorie
      let addCat = document.createElement('div');
      addCat.innerHTML = `
        <input id='nomCat' placeholder='Nom de la cat√©gorie'>
        <select id='typeCat'>
          <option value='d√©pense'>D√©pense</option>
          <option value='recette'>Recette</option>
        </select>
        <button onclick='ajouterCategorie()'>Ajouter</button>`;
      catDiv.appendChild(addCat);

      // --- Transactions ---
      let transDiv = document.createElement('div');
      transDiv.innerHTML = "<h2>Transactions</h2>";
      let transTable = document.createElement('table');
      transTable.innerHTML = "<tr><th>Nom</th><th>Montant</th><th>Cat√©gorie</th><th>Action</th></tr>";

      data.transactions.forEach((t, i) => {
        let row = document.createElement('tr');
        row.innerHTML = `
          <td>${t.nom}</td>
          <td>${t.montant}</td>
          <td>${t.categorie}</td>
          <td><button class='delete-btn' onclick='supprimerTransaction(${i})'>üóëÔ∏è</button></td>`;
        transTable.appendChild(row);
      });
      transDiv.appendChild(transTable);

      // Ajout transaction
      let addTrans = document.createElement('div');
      let options = data.categories.map(c => `<option>${c.nom}</option>`).join('');
      addTrans.innerHTML = `
        <input id='nomTrans' placeholder='Nom de la transaction'>
        <input id='montantTrans' type='number' placeholder='Montant'>
        <select id='catTrans'>${options}</select>
        <button onclick='ajouterTransaction()'>Ajouter</button>`;
      transDiv.appendChild(addTrans);

      app.appendChild(catDiv);
      app.appendChild(transDiv);
    }

    function ajouterCategorie() {
      let nom = document.getElementById('nomCat').value.trim();
      let type = document.getElementById('typeCat').value;
      if (!nom) return alert("Nom de cat√©gorie manquant !");
      data.categories.push({ nom, type });
      sauvegarder();
      afficher();
    }

    function ajouterTransaction() {
      let nom = document.getElementById('nomTrans').value.trim();
      let montant = parseFloat(document.getElementById('montantTrans').value);
      let cat = document.getElementById('catTrans').value;
      if (!nom || isNaN(montant)) return alert("Transaction incompl√®te !");
      data.transactions.push({ nom, montant, categorie: cat });
      sauvegarder();
      afficher();
    }

    function supprimerCategorie(index) {
      let catName = data.categories[index].nom;
      if (!confirm(`Supprimer la cat√©gorie "${catName}" et toutes les transactions associ√©es ?`)) return;

      // Supprimer transactions li√©es
      data.transactions = data.transactions.filter(t => t.categorie !== catName);

      // Supprimer la cat√©gorie
      data.categories.splice(index, 1);

      sauvegarder();
      afficher();
    }

    function supprimerTransaction(index) {
      if (!confirm("Supprimer cette transaction ?")) return;
      data.transactions.splice(index, 1);
      sauvegarder();
      afficher();
    }

    // --- Export / Import ---
    document.getElementById('exportBtn').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'moneyflow_data.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById('importBtn').addEventListener('click', () => {
      document.getElementById('importFile').click();
    });

    document.getElementById('importFile').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const imported = JSON.parse(event.target.result);
          if (imported.categories && imported.transactions) {
            data = imported;
            sauvegarder();
            afficher();
            alert("‚úÖ Donn√©es import√©es avec succ√®s !");
          } else {
            alert("Fichier invalide.");
          }
        } catch (err) {
          alert("Erreur lors de l'importation.");
        }
      };
      reader.readAsText(file);
    });

    afficher();
  </script>
</body>
</html>
